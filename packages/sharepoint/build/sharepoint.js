Ext.define("Sharepoint.data.WebServices",{singleton:true,buildSOAPPacket:function(e,f,b){var d="",a="",c;if(e){for(c in e){if(e.hasOwnProperty(c)){a+="<"+c+">"+e[c]+"</"+c+">"}}d='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><'+f+' xmlns="'+b+'">'+a+"</"+f+"></soap:Body></soap:Envelope>"}else{d='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><'+f+' xmlns="'+b+'" /></soap:Body></soap:Envelope>'}return d},createRequest:function(d,f,e,c,a,b){Ext.Ajax.request({url:d,nosim:false,actionMethod:{read:"POST"},headers:{SOAPAction:c+f,"Content-Type":"text/xml; charset=utf-8"},xmlData:this.buildSOAPPacket(e,f,c),scope:a,callback:b})},searchRequest:function(c,e,d,b){var a=Ext.Ajax.request({url:c,method:"POST",headers:{SOAPAction:b+"/"+e,"Content-Type":"text/xml; charset=utf-8"},xmlData:this.buildSOAPPacket(d,e,b)});return a},copyNamespace:"http://schemas.microsoft.com/sharepoint/soap/",copyService:L_Menu_BaseUrl+"/_vti_bin/Copy.asmx",listsNamespace:"http://schemas.microsoft.com/sharepoint/soap/",listsService:L_Menu_BaseUrl+"/_vti_bin/Lists.asmx",permissionsNamespace:"http://schemas.microsoft.com/sharepoint/soap/directory/",permissionsService:L_Menu_BaseUrl+"/_vti_bin/Permissions.asmx",userGroupNamespace:"http://schemas.microsoft.com/sharepoint/soap/directory/",userGroupService:L_Menu_BaseUrl+"/_vti_bin/UserGroup.asmx",viewsNamespace:"http://schemas.microsoft.com/sharepoint/soap/",viewsService:L_Menu_BaseUrl+"/_vti_bin/Views.asmx",versionsNamespace:"http://schemas.microsoft.com/sharepoint/soap/",versionsService:L_Menu_BaseUrl+"/_vti_bin/Versions.asmx",workflowNamespace:"http://schemas.microsoft.com/sharepoint/soap/workflow/",workflowService:L_Menu_BaseUrl+"/_vti_bin/Workflow.asmx",websNamespace:"http://schemas.microsoft.com/sharepoint.soap/",websService:L_Menu_BaseUrl+"/_vti_bin/Webs.asmx",queryExNamespace:"http://microsoft.com/webservices/OfficeServer/QueryService",searchNamespace:"urn:Microsoft.Search",searchService:L_Menu_BaseUrl+"/_vti_bin/Search.asmx",query:function(a){var c="Query",b={queryXml:"<![CDATA["+a+"]]>"};return this.searchRequest(this.searchService,c,b,this.searchNamespace)},queryEx:function(a){var c="QueryEx",b={queryXml:a};return this.searchRequest(this.searchService,c,b,this.queryExNamespace)},addGroup:function(h,b,d,i,f,e,g){var a="AddGroup",c={groupName:h,ownerIdentifier:b,ownerType:d,defaultUserLoginName:i,description:f};return this.createRequest(this.userGroupService,a,c,this.userGroupNamespace,e,g)},addList:function(c,e,b,a,d){var g="AddList",f={listName:c,description:e,templateID:b};return this.createRequest(this.listsService,g,f,this.listsNamespace,a,d)},addListFromFeature:function(c,h,g,e,b,f,i){var a="AddListFromFeature",d={listName:c,description:h,featureID:g,templateID:e,customTemplate:b};return this.createRequest(this.listsService,a,d,this.listsNamespace,f,i)},addPermission:function(d,b,g,f,i,e,h){var a="AddPermission",c={objectName:d,objectType:b,permissionIdentifier:g,permissionType:f,permissionMask:i};return this.createRequest(this.permissionsService,a,c,this.permissionsNamespace,e,h)},addUserToGroup:function(h,f,i,c,b,e,g){var a="AddUserToGroup",d={groupName:h,userName:f,userLoginName:i,userEmail:c,userNotes:b};return this.createRequest(this.userGroupService,a,d,this.userGroupNamespace,e,g)},addAttachment:function(c,b,h,f,a,d){var g="AddAttachment",e={listName:c,listItemID:b,fileName:h,attachment:f};this.createRequest(this.listsService,g,e,this.listsNamespace,a,d)},callUpdateListItems:function(b,g,d,c,h,m){var f,a,e=0,k,j,l;f="<Batch OnError='Continue'";if(c!==null){f+=" RootFolder='"+c+"'"}f+=">";if(g.constructor!==Array){a=[g]}else{a=g}k=a.length;for(e;e<k;e++){l=a[e];f+="<Method ID='1' Cmd='"+d+"'>";for(j in l){if(l.hasOwnProperty(j)){f+="<Field Name='"+j+"'><![CDATA["+l[j]+"]]></Field>"}}f+="</Method>"}f+="</Batch>";return this.updateListItems(b,f,h,m)},callFolderNew:function(d,g,f,b,a,e){var c;c="<Batch OnError='Continue'";if(b!==null){c+=" RootFolder='"+b+"'"}c+=">";c+="<Method ID='1' Cmd='"+f+"'><Field Name='FSObjType'>1</Field><Field Name='BaseName'>"+g+"</Field></Method></Batch>";return this.updateListItems(d,c,a,e)},callFolderUpdate:function(c,h,d,g,f,a,e){var b;b="<Batch OnError='Continue'>";b+="<Method ID='1' Cmd='"+f+"'><Field Name='FSObjType'>1</Field><Field Name='ID'>"+h+"</Field><Field Name='FileRef'>"+d+"</Field><Field Name='BaseName'>"+g+"</Field></Method></Batch>";return this.updateListItems(c,b,a,e)},copyIntoItems:function(b,d,f,e,a,c){var h="CopyIntoItems",g={SourceUrl:b,DestinationUrls:"<string>"+d+"</string>",Fields:f,Stream:e};return this.createRequest(this.copyService,h,g,this.copyNamespace,a,c)},copyIntoItemsLocal:function(b,d,a,c){var f="CopyIntoItemsLocal",e={SourceUrl:b,DestinationUrls:"<string>"+d+"</string>"};return this.createRequest(this.copyService,f,e,this.copyNamespace,a,c)},createFolder:function(c,e,b,a,d){return this.callFolderNew(c,e,"New",b,a,d)},updateFolder:function(b,f,c,e,a,d){return this.callFolderUpdate(b,f,c,e,"Update",a,d)},deleteList:function(b,a,c){var e="DeleteList",d={listName:b};return this.createRequest(this.listsService,e,d,this.listsNamespace,a,c)},getGroupCollectionFromSite:function(a,b){var d="GetGroupCollectionFromSite",c={};return this.createRequest(this.userGroupService,d,c,this.userGroupNamespace,a,b)},getGroupCollectionFromUser:function(b,a,c){var e="GetGroupCollectionFromUser",d={userLoginName:b};this.createRequest(this.userGroupService,e,d,this.userGroupNamespace,a,c)},getGroupInfo:function(e,a,b){var d="GetGroupInfo",c={groupName:e};this.createRequest(this.userGroupService,d,c,this.userGroupNamespace,a,b)},getList:function(b,a,c){var e="GetList",d={listName:b};this.createRequest(this.listsService,e,d,this.listsNamespace,a,c)},getListAndView:function(d,b,g,a,c){var h="GetListAndView",f={listName:b,viewName:g},e=d+"/_vti_bin/Lists.asmx";this.createRequest(e,h,f,this.listsNamespace,a,c)},getListCollection:function(a,b){var d="GetListCollection",c={};this.createRequest(this.listsService,d,c,this.listsNamespace,a,b)},getListItems:function(b,i,h,k,f,c,d,g,j){if(c===null||c===""){c="<QueryOptions/>"}var a="GetListItems",e={listName:b,viewName:i,query:h,viewFields:k,rowLimit:f,queryOptions:c,webID:d};this.createRequest(this.listsService,a,e,this.listsNamespace,g,j)},crossSiteGetListItems:function(h,b,j,i,l,f,c,d,g,k){if(c===null||c===""){c="<QueryOptions/>"}var a="GetListItems",e={listName:b,viewName:j,query:i,viewFields:l,rowLimit:f,queryOptions:c,webID:d},m=h+"/_vti_bin/Lists.asmx";this.createRequest(m,a,e,this.listsNamespace,g,k)},getPermissionCollection:function(f,b,a,c){var e="GetPermissionCollection",d={objectName:f,objectType:b};return this.createRequest(this.permissionsService,e,d,this.permissionsNamespace,a,c)},getTemplatesForItem:function(c,a,b){var e="GetTemplatesForItem",d={item:c};return this.createRequest(this.workflowService,e,d,this.workflowNamespace,a,b)},getView:function(b,e,a,c){var f="GetView",d={listName:b,viewName:e};this.createRequest(this.viewsService,f,d,this.viewsNamespace,a,c)},getViewCollection:function(b,a,c){var e="GetViewCollection",d={listName:b};this.createRequest(this.viewsService,e,d,this.viewsNamespace,a,c)},getVersionCollection:function(c,b,e,a,d){var g="GetVersionCollection",f={strlistID:c,strlistItemID:b,strFieldName:e};return this.createRequest(this.listsService,g,f,this.listsNamespace,a,d)},getVersions:function(e,a,b){var d="GetVersions",c={fileName:e};return this.createRequest(this.versionsService,d,c,this.versionsNamespace,a,b)},getUserCollection:function(c,a,b){var e="GetUserCollection",d={userLoginNamesXml:c};return this.createRequest(this.userGroupService,e,d,this.userGroupNamespace,a,b)},getUserCollectionFromSite:function(a,b){var d="GetUserCollectionFromSite",c={};this.createRequest(this.userGroupService,d,c,this.userGroupNamespace,a,b)},getUserCollectionFromGroup:function(e,a,b){var d="GetUserCollectionFromGroup",c={groupName:e};return this.createRequest(this.userGroupService,d,c,this.userGroupNamespace,a,b)},getRoleCollectionFromUser:function(b,a,c){var e="GetRoleCollectionFromUser",d={userLoginName:b};return this.createRequest(this.userGroupService,e,d,this.userGroupNamespace,a,c)},getRoleCollectionFromWeb:function(a,b){var d="GetRoleCollectionFromWeb",c={};this.createRequest(this.userGroupService,d,c,this.userGroupNamespace,a,b)},getWeb:function(c,a,b){var e="GetWeb",d={webUrl:c};return this.createRequest(this.websService,e,d,this.websNamespace,a,b)},getWebCollection:function(a,b){var d="GetWebCollection",c={};return this.createRequest(this.websService,d,c,this.websNamespace,a,b)},getAllSubWebCollection:function(a,b){var d="GetAllSubWebCollection",c={};return this.createRequest(this.websService,d,c,this.websNamespace,a,b)},quickAddListItem:function(d,c,b,a,e){return this.callUpdateListItems(d,c,"New",b,a,e)},quickDeleteDocLibItem:function(b,d,c,g,l){var f,a=[],e=0,j,h,k;f="<Batch OnError='Continue'>";if(d.constructor===Array){j=d.length;for(e;e<j;e++){a.push({ID:d[e]})}}else{j=1;a=[{ID:d}]}for(e=0;e<j;e++){k=a[e];f+="<Method ID='1' Cmd='Delete'>";for(h in k){if(k.hasOwnProperty(h)){f+="<Field Name='"+h+"'><![CDATA["+k[h]+"]]></Field>";f+='<Field Name="FileRef">'+c+"</Field>"}}f+="</Method>"}f+="</Batch>";return this.updateListItems(b,f,g,l)},quickDeleteListItem:function(d,b,a,f){var g=[],e=0,c=b.length;if(b.constructor===Array){for(e;e<c;e++){g.push({ID:b[e]})}}else{g=[{ID:b}]}return this.callUpdateListItems(d,g,"Delete",null,a,f)},quickUpdateListItem:function(d,c,b,a,e){return this.callUpdateListItems(d,c,"Update",b,a,e)},removeGroup:function(e,a,b){var d="RemoveGroup",c={groupName:e};return this.createRequest(this.userGroupService,d,c,this.userGroupNamespace,a,b)},removePermissionCollection:function(g,b,d,a,c){var f="RemovePermissionCollection",e={objectName:g,objectType:b,memberIdsXml:d};return this.createRequest(this.permissionsService,f,e,this.permissionsNamespace,a,c)},removeUserFromGroup:function(f,b,a,c){var e="RemoveUserFromGroup",d={groupName:f,userLoginName:b};return this.createRequest(this.userGroupService,e,d,this.userGroupNamespace,a,c)},startWorkflow:function(e,c,b,a,d){var g="StartWorkflow",f={item:e,templateId:c,workflowParameters:b};return this.createRequest(this.workflowService,g,f,this.workflowNamespace,a,d)},updateGroupInfo:function(c,i,b,e,g,f,h){var a="UpdateGroupInfo",d={oldGroupName:c,groupName:i,ownerIdentifier:b,ownerType:e,description:g};return this.createRequest(this.userGroupService,a,d,this.userGroupNamespace,f,h)},updateListItems:function(b,d,a,c){var f="UpdateListItems",e={listName:b,updates:d};return this.createRequest(this.listsService,f,e,this.listsNamespace,a,c)},base64:{keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(d){var l,j,g,k,h,f,e,c,b=0,a="";d=Ext.ux.sharepoint.WebServices.base64.utf8_encode(d);c=d.length;while(b<c){l=d.charCodeAt(b++);j=d.charCodeAt(b++);g=d.charCodeAt(b++);k=l>>2;h=((l&3)<<4)|(j>>4);f=((j&15)<<2)|(g>>6);e=g&63;if(isNaN(j)){f=e=64}else{if(isNaN(g)){e=64}}a=a+this.keyStr.charAt(k)+this.keyStr.charAt(h)+this.keyStr.charAt(f)+this.keyStr.charAt(e)}return a},decode:function(d){var l,j,g,k,h,f,e,c,b=0,a="";d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");c=d.length;while(b<c){k=this.keyStr.indexOf(d.charAt(b++));h=this.keyStr.indexOf(d.charAt(b++));f=this.keyStr.indexOf(d.charAt(b++));e=this.keyStr.indexOf(d.charAt(b++));l=(k<<2)|(h>>4);j=((h&15)<<4)|(f>>2);g=((f&3)<<6)|e;a=a+String.fromCharCode(l);if(f!==64){a=a+String.fromCharCode(j)}if(e!==64){a=a+String.fromCharCode(g)}}a=Ext.ux.sharepoint.WebServices.base64.utf8_decode(a);return a},utf8_encode:function(d){d=d.replace(/\r\n/g,"\n");var b="",a=d.length,f=0,e;for(f;f<a;f++){e=d.charCodeAt(f);if(e<128){b+=String.fromCharCode(e)}else{if((e>127)&&(e<2048)){b+=String.fromCharCode((e>>6)|192);b+=String.fromCharCode((e&63)|128)}else{b+=String.fromCharCode((e>>12)|224);b+=String.fromCharCode(((e>>6)&63)|128);b+=String.fromCharCode((e&63)|128)}}}return b},utf8_decode:function(a){var d="",g=0,f=a.length,h=0,e=0,b;while(g<f){h=a.charCodeAt(g);if(h<128){d+=String.fromCharCode(h);g++}else{if((h>191)&&(h<224)){e=a.charCodeAt(g+1);d+=String.fromCharCode(((h&31)<<6)|(e&63));g+=2}else{e=a.charCodeAt(g+1);b=a.charCodeAt(g+2);d+=String.fromCharCode(((h&15)<<12)|((e&63)<<6)|(b&63));g+=3}}}return d}},moveDocLibFolder:function(e,f,a,d){var g="findbacklinks",b="overwrite,createdir,migrationsemantics",c=false;method=Ext.String.format("method=move+document%3a12.0.4518.1016&service_name=%2f&oldUrl={0}&newUrl={1}&url_list=[]&rename_option={2}&put_option={3}&docopy={4}",e,f,g,b,c);Ext.Ajax.request({url:L_Menu_BaseUrl+"/_vti_bin/_vti_aut/author.dll",actionMethod:{read:"POST"},headers:{"Content-Type":"application/x-vermeer-urlencoded","X-Vermeer-Content-Type":"application/x-vermeer-urlencoded"},xmlData:method,scope:a,callback:d})}});Ext.define("Sharepoint.data.proxy.SPList",{extend:Ext.data.soap.Proxy,alias:"proxy.splistsoap",constructor:function(b){var c=this,a;b=b||{};a=b.baseSiteUrl||L_Menu_BaseUrl;Ext.apply(b,{url:a+"/_vti_bin/Lists.asmx",envelopeTpl:['<?xml version="1.0" encoding="utf-8"?>','<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">{[values.bodyTpl.apply(values)]}',"</soap:Envelope>"],createBodyTpl:["<soap:Body>",'<{operation} xmlns="{targetNamespace}">',"<listName>{params.listName}</listName>","<updates>",'<Batch OnError="Continue" RootFolder="">','<tpl for="records">','<Method ID="{[xindex]}" Cmd="New">','<tpl if="docLibrary">','<Field Name="FSObjType">1</Field>','<Field Name="ID">New</Field>','<Field Name="BaseName>{[values.get("Name")]}</Field>','<Field Name="ContentType">{[values.get("ContentType")]}</Field>',"<tpl else>",'<tpl for="fields">','<tpl if = "persist">','<Field Name="{name}">{[this.getModifiedValue(parent, values.name)]}</Field>',"</tpl>","</tpl>","</tpl>","</Method>","</tpl>","</Batch>","</updates>","</{operation}>","</soap:Body>",{getIdField:function(d){var e=d.idProperty;return d.get(e)},getModifiedValue:function(e,h){var g=e.fields.get(h),d=g.dateWriteFormat||g.dateFormat,f=e.get(h);if(g.serialize){f=g.serialize(f,e)}else{if(g.type===Ext.data.Types.DATE&&d&&Ext.isDate(f)){f=Ext.Date.format(f,d)}}return"<![CDATA["+f+"]]>"}}],updateBodyTpl:["<soap:Body>",'<{operation} xmlns="{targetNamespace}">',"<listName>{params.listName}</listName>","<updates>",'<Batch OnError="Continue" RootFolder="">','<tpl for="records">','<Method ID="{#}" Cmd="Update">','<tpl if="docLibrary">','<Field Name="FSObjType">1</Field>','<Field Name="ID">{[this.getIdField(values)]}</Field>','<Field Name="FileRef>{[values.get("Path")]}</Field>','<Field Name="BaseName">{[values.get("Name")]}</Field>',"<tpl else>",'<Field Name="ID">{[this.getIdField(values)]}</Field>','<tpl foreach="modified">','<Field Name="{$}">{[this.getModifiedValue(parent, xkey)]}</Field>',"</tpl>","</tpl>","</Method>","</tpl>","</Batch>","</updates>","</{operation}>","</soap:Body>",{getIdField:function(d){var e=d.idProperty;return d.get(e)},getModifiedValue:function(e,h){var g=e.fields.get(h),d=g.dateWriteFormat||g.dateFormat,f=e.get(h);if(g.serialize){f=g.serialize(f,e)}else{if(g.type===Ext.data.Types.DATE&&d&&Ext.isDate(f)){f=Ext.Date.format(f,d)}}return"<![CDATA["+f+"]]>"}}],destroyBodyTpl:["<soap:Body>",'<{operation} xmlns="{targetNamespace}">',"<listName>{params.listName}</listName>","<updates>",'<Batch OnError="Continue" RootFolder="">','<tpl for="records">','<Method ID="{#}" Cmd="Delete">','<tpl if="docLibrary">','<Field Name="FSObjType">1</Field>','<Field Name="ID">{[this.getIdField(values)]}</Field>','<Field Name="FileRef">{[this.unescapeString(values.get("Path"))]}</Field>',"<tpl else>",'<Field Name="ID">{[this.getIdField(values)]}</Field>',"</tpl>","</Method>","</tpl>","</Batch>","</updates>","</{operation}>","</soap:Body>",{getIdField:function(d){var e=d.idProperty;return d.get(e)},unescapeString:function(d){return unescapeProperly(d)}}],api:{read:"GetListItems",create:"UpdateListItems",destroy:"UpdateListItems",update:"UpdateListItems"},soapAction:{read:"http://schemas.microsoft.com/sharepoint/soap/GetListItems",create:"http://schemas.microsoft.com/sharepoint/soap/UpdateListItems",update:"http://schemas.microsoft.com/sharepoint/soap/UpdateListItems",destroy:"http://schemas.microsoft.com/sharepoint/soap/UpdateListItems"},operation:"op",targetNamespace:"http://schemas.microsoft.com/sharepoint/soap/",reader:{type:"soap",record:"z|row",namespace:"z"}});c.callParent([b])}});